<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <!-- 为了确保绘制和触摸屏缩放，需要添加viewport元标签 -->
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name=”renderer” content=”webkit” />  

        <!-- 设置viewport, user-scalable=no可以进制缩放，这样可以让你的网站更像原生应用，不推荐所有网站使用 -->
        <!-- <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"> -->
        
        <link href="/assets/css/bootstrap.css" rel="stylesheet">
        <link href="/assets/css/bootstrap-theme.css" rel="stylesheet">

        <link rel="stylesheet" href="/assets/OwlCarousel/assets/owl.carousel.min.css">
        <link rel="stylesheet" href="/assets/OwlCarousel/assets/owl.theme.default.min.css">

        <script src="/assets/js/jquery-3.4.1.js"></script>
        <script src="/assets/js/bootstrap.js"></script>

        <script src="/assets/js/run_prettify.js"></script>

        <style>
          .owl-carousel {
            width: auto !important;
            height: auto !important;
          }
        </style>
        
        <title>DcmAppTest - 文档</title>

        <style>
        </style>
    </head>

    <!-- bootstrap默认主持颜色时#fff -->
    <body>
        <!-- container, container-fluid的区别，后面时页面宽度为100%， 前者不是 -->
        <!-- 导航栏 -->
        <nav class="navbar navbar-default navbar-fixed-top">
          <div class="container">
            <!-- 导航栏头(放置项目Logo) -->
            <div class="navbar-header">
              <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" 
                data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a href="#" class="navbar-brand" style="margin-top: -5px;"><img src="./assets/img/SmallDcm.ico"></a>
              <a href="./index.html" class="navbar-brand" style="margin-left: -20px;">DcmAppTest</a>
            </div>

            <!-- 存放导航内容 -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
              <!-- 在导航右侧添加导航控件 -->
              <ul class="nav navbar-nav navbar-right">
                <li class="active"><a href="#"><span class="glyphicon glyphicon-list-alt"></span> 文档</a></li>
                <li><a href="./index.html#Features"><span class="glyphicon glyphicon-eye-open"></span> 特性</a></li>
                <li>
                  <a href="https://github.com/twoflyliu/dcmapptest" target="_blank">
                    <span class="glyphicon glyphicon-tasks"></span> GitHub
                  </a>
                </li>
                <li>
                  <a href="/index.html">
                    <span class="glyphicon glyphicon-home"></span> TwoFlyLiu
                  </a>
                </li>
              </ul>
            </div>

          </div>
        </nav>

        <div class="container" style="margin-top: 70px;">
          <div class="row">
            <div class="col-md-3">
              <div class="list-group page-menu" id="page-menu" style="position: fixed;">
                <button type="button" class="list-group-item active">简介</button>
                <button type="button" class="list-group-item ">前置步骤</button>
                <button type="button" class="list-group-item ">安装</button>
                <button type="button" class="list-group-item">主窗口界面介绍&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</button>
                <button type="button" class="list-group-item">基本使用</button>
                <button type="button" class="list-group-item">自定义/安装安全算法插件</button>
                <button type="button" class="list-group-item">感谢</button>
              </div>
            </div>
            <div class="col-md-9" id="page-content-container">
              <div class="page-content">
                <h4>简介</h4>
                <hr>
                <p>DcmAppTest相当于VehicleSpy3和Canoe一个子集，只包含车载诊断测试功能。当前支持的TP协议只有ISO15765协议，应用协议支持ISO14229协议</p>
                <p>本软件基于C# .net Framework 4.0开发，即使XP系统也可以运行本软件</p>
                <p>使用本软件可以根据自己对应项目的车载诊断需求来新建对应的服务和子功能，来满足自己的需求。</p>
                <p>相比较于VehicleSpy3和Canoe两者商业软件，本软件完全免费开源，完全可以使用本软件来满足对于车载诊断应用的测试需求。</p>
                <p>本软件只用于测试车载CAN诊断应用，不能用来模拟车身的应用报文，如果您想模拟车身的应用报文，请看<a href="/ecanspy3/index.html">EcanSpy3</a></p>
              </div>

              <div class="page-content sr-only">
                <h4>前置步骤</h4>
                <hr>
                <p>
                  1.因为本程序支持的CAN设备是广成科技的CAN设备，所以你需要有个广诚科技的USB CAN盒</li>
                </p>
                <p>
                  2.安装号USB CAN盒驱动，并且和电脑连接起来
                </p>
                <p>
                  3.请确保您的PC上安装了.Net Framework 4以上的版本
                </p>
              </div>

              <div class="page-content sr-only">
                <h4>安装</h4>
                <hr>
                <p>1.点击DcmAppTest主页上的下载按钮，您会得到一个zip压缩文件</p>
                <p>
                   2.将此压缩文本解压缩到本地，您会得到如下的文件结构：<br>
                   | DcmAppTest - 版本号<br>
                   | --- addins<br>
                   | ------ DummySecurityAccess.dll<br>
                   | --- 若干个dll文件<br>
                   | --- CSDcmTest.exe<br>
                   | --- CSDcmTest.exe.config<br>
                   | --- CSDcmTest.exe.manifest<br>
                </p> 
                <p>
                  您将下载的压缩文件解压到某个路径，运行解压下根目录中的CSDcmTest.exe即可运行本应用。
                </p>
              </div>

              <!-- long-content -->
              <div class="page-content sr-only long-content">
                <h4>主窗口界面介绍</h4>
                <hr>
                <p>
                  1. 主窗口功能分配如下图：
                  <img src="./assets/img/Tutor/MainForm/MainFormCategory-Main.png" class="img-responsive"><br>
                  2. Vdf窗口分类如下图：
                  <img src="./assets/img/Tutor/MainForm/MainFormCategory-Vdf.png" class="img-responsive"><br>
                </p>
                <h4>界面中涉及到的概念</h4>
                <p>
                  <ol>
                    <li>服务 - 对应于ISO14229中的服务，他们一般是一一对应关系，当然你也可以定义一些ISO14229之外的服务，本软件也是支持的</li>
                    <li>子功能 - 对应于ISO14229中的子功能，但是不是绝对的对应，这儿更准确的将，可以成为功能，每个子功能对应的功能（因为ISO14229中定义某些服务是没有子功能的）</li>
                    <li>配置窗口中涉及到的概念：</li>
                    <ul>
                      <li>物理请求CANID， 熟悉CAN的朋友肯定熟悉此概念</li>
                      <li>功能请求CANID</li>
                      <li>响应CANID</li>
                      <li>安全算法类型，这儿以组合框的形式展现，当您下载的时候，会出现Dummy，Dummy就是之前我们安装的插件</li>
                      <li>维持在线的相关设置，也是ISO协议定义的一个服务</li>
                    </ul>
                    <li>值描述文件中，涉及到的概念：</li>
                    <ul>
                      <li>报文 - 定义了一个被引用的名称，描述和字节长度</li>
                      <li>信号 - 定义了一个被引用的名称，起始位，长度，字节序和值描述</li>
                      <li>值描述 - 定义了值对应的描述 （四种类型值）</li>
                    </ul>
                  </ol>
                </p>
              </div>

              <div class="page-content sr-only long-content">
                <h4>基本使用</h4>
                <hr>
                <p>
                  1. 新建一个文件, 可以点击菜单，或者工具按钮，入下图所示（仅展示工具按钮）：
                  <img src="./assets/img/Tutor/BaseUsage/NewDocument.png" class="img-responsive">
                </p>
                <p>
                  2. 保存文件到指定路径, 入下图所示：
                  <img src="./assets/img/Tutor/BaseUsage/SaveDocument.png" class="img-responsive">
                </p>
                <p>
                  3. 创建Communication Control服务, 入下图所示：
                  <img src="./assets/img/Tutor/BaseUsage/CreateCommunicationControlService.png" class="img-responsive">
                </p>
                <p>
                  4. 创建Communication Type 值描述，入下图所示
                  <img src="./assets/img/Tutor/BaseUsage/1.CreateCommunicationTypeValDesc.png" class="img-responsive">
                  <img src="./assets/img/Tutor/BaseUsage/1.AfterCommunicationTypeValDesc.png" class="img-responsive">
                  <img src="./assets/img/Tutor/BaseUsage/3.UpdateCommunicationTypeName.png" class="img-responsive">
                  <img src="./assets/img/Tutor/BaseUsage/4.UpdateCommunicationTypeContent.png" class="img-responsive">
                </p>
                <p>
                  5. 创建Communication Type报文, 入下图所示
                  <img src="./assets/img/Tutor/BaseUsage/1.CreateCommunicationTypeMessage.png" class="img-responsive">
                  <img src="./assets/img/Tutor/BaseUsage/1.UpdateCommunicationTypeMessage.png" class="img-responsive">
                </p>
                <p>
                  6. 创建Communition Type信号， 入下图所示
                  <img src="./assets/img/Tutor/BaseUsage/1.CreateCommunicationTypeSignal.png" class="img-responsive">
                  <img src="./assets/img/Tutor/BaseUsage/1.UpdateCommunicationTypeSignal.png" class="img-responsive">
                </p>
                <p>
                  7. 创建EnableRxAndTx子功能，入下图所示
                  <img src="./assets/img/Tutor/BaseUsage/1.createEnableRxAndTx.png" class="img-responsive">
                  <img src="./assets/img/Tutor/BaseUsage/1.afterCreateEnableRxAndTx.png" class="img-responsive">
                </p>
                <h4>其他</h4>
                <hr>
                <p>熟悉上面的用户，即基本入门了，对于其他功能，可以参考Demos/Dummy.dcmproj文件</p>
                <p>
                  对于其他的功能值简单说一下：<br>
                  <ol>
                    <li>对于需要接收某些接收到的数据，只需要将子功能的解析方法设置位Receive即可</li>
                    <li>对于其他的只描述，比如Bcd, Phy, ASCII，只需要在在添加只描述菜单中选择相应的值描述即可</li>
                  </ol>
                </p>
              </div>

              <div class="page-content sr-only long-content">
                <h4>自定义安全算法插件</h4>
                <hr>

                <h4><small>前置条件：</small></h4>
                <p>
                  1. 请确保您的PC上安装Visual Studio 2017以上的版本，个人推荐Visual Studio 2017社区版，可以免费使用<br>
                  2. 从GitHub上，将本项目源码拷贝过来，然后使用安装好的VS打开<code>DcmAppTest.sln</code>
                </p>

                <h4><small>步骤</small></h4>
                <p>
                  1. 使用VS2017社区版(我使用的版本，您至少需求>=此版本, 这样工程才可以进行编译)Visual C#创建类库工程, 入下图所示：
                  <img src="./assets/img/Tutor/DefineSecurityPlugin/Step1-CreatePlugLib.png" class="img-responsive">
                </p>
                <p>
                  2. 设置项目引用的类型<br>
                  ① 引入SecurityAccessContract, 因为SecurityAccessContract项目中定义了插件接口的类型，入下图所示：
                  <img src="./assets/img/Tutor/DefineSecurityPlugin/Step2-SetReference.png" class="img-responsive">
                  ② 需要引用System.ComponentModel.Composition程序集，因为此程序集定义了插件导出的方式，入下图所示：
                  <img src="./assets/img/Tutor/DefineSecurityPlugin/Step2-System.ComponentModel.Composition.png" class="img-responsive">
                </p>
                <p>
                  3. 实现插件<br><br>
                  在实现插件之前，需要介绍一下SecurityAccessContract.ISecurityAccessAlgorithm接口<br>
                  此接口定义如下：<br>
                  <pre class="prettyprint"><code class="language-cs">namespace SecurityAccessContract
{
    public interface ISecurityAccessAlgorithm
    {
        /// &lt;summary&gt;
        /// 算法实现
        /// &lt;/summary&gt
        /// &lt;param name="securityLevel"&gt算法安全级别&lt;/param&gt
        /// &lt;param name="rawData"&gt原始数据&lt;/param&gt
        /// &lt;returns&gt加密后的数据&lt;/returns&gt
        List&lt;byte&gt Encrypt(int securityLevel, List&lt;byte&gt rawData);

        /// &lt;summary&gt
        /// 算法名称
        /// &lt;/summary&gt
        string Name { get;  }
    }
}</code></pre>
                  此接口是插件需要实现的接口，其中：
                  <ul>
                    <li>Encrypt方法用于根据种子数据来生成对应的Key, 根据ISO14229定义， securityLevel是27 SID后面的数据，一般为奇数；rawData 为27 奇数请求返回的种子数据， 此方法返回值为Key数据</li>
                    <li>Name 表示安全算法的名称，因为最终所有的插件需要被放置在一个组合框中供用户来选择插件类型，所以插件需要一个可以被显示的字符串，而这个方法就是返回这个字符串</li>
                  </ul>
                </p>
                <p>
                  4. 下面来看一下Dummy安全算法的实现，具体的实现, 代码如下所示：
                  <pre class="prettyprint"><code class="language-cs">namespace DummySecurityAccess
{
    [Export(typeof(ISecurityAccessAlgorithm))]
    public class SecurityAccessAlgorithm : ISecurityAccessAlgorithm
    {
        public const int ExtendSessionLevel = 0x01;

        public string Name => "Dummy";

        public List&lt;byte&gt; Encrypt(int securityLevel, List&lt;byte&gt; rawData)
        {
            if (securityLevel % 2 == 0)
            {
                securityLevel -= 1;
            }

            if (securityLevel < 0)
            {
                throw new ArgumentException("security level must be great than 0");
            }

            if (ExtendSessionLevel == securityLevel)
            {
                return ExtendSessionLevelEncrypt(rawData);
            }
            else
            {
                throw new ArgumentException("Unsupported security level " + securityLevel.ToString());
            }
        
        }

        private List&lt;byte&gt;ExtendSessionLevelEncrypt(List&lt;byte&gt; seed)
        {
            if (seed.Count != 4)
            {
                throw new ArgumentException("seed data length must be 4");
            }

            List&lt;byte&gt; key = new List&lt;byte&gt;();
            const byte increVal = 0x55;

            foreach (var s in seed)
            {
                key.Add((byte)(increVal + s));
            }
            return key;
        }
    }

}</code></pre>
                </p>
                <p>
                  首先，定义SecurityAccessAlgorithm类，并且让此类实现ISecurityAccessAlgorithm, 除此之外，此类还有一个Attribute:[Export(typeof(ISecurityAccessAlgorithm))], 
                  只有定义 了这个Attribute，那么这个插件才可以被当作插件识别到
                </p>
                <p>
                  正如何您所看到，插件的名称为Dummy(public string Name => "Dummy"), 插件安全算法的实现，是只支持安全级别为1的级别；并且要求种子的长度为4；当前两者都满足的时候，
                   会将总之的每个值都加上0x55作为Key返回
                </p>
                <p>
                  5. 编译生成， 终止应该生成一个名为DummySecurityAccess.dll文件, 入下图所示：
                  <img src="./assets/img/Tutor/DefineSecurityPlugin/Step3-FinalPlugFile.png" class="img-responsive">
                  <br>
                </p>

                <h4>安装编译好的插件</h4>
                <hr>
                <p>
                  <ol>
                    <li>解压缩历史版本中列出的压缩文件到指定目录中</li>
                    <li>如果解压缩目录中没有addins文件，则新建此文件夹</li>
                    <li>将上面最后编译生成的插件DummySecurityAccess.dll拷贝到此文件夹中即可</li>
                  </ol>
                </p>
              </div>

              <div class="page-content sr-only">
                <h4>感谢</h4>
                <hr>
                <p>
                  <ul>
                    <li><a href="https://github.com/dockpanelsuite/dockpanelsuite" target="_blank">感谢DockSuite项目</a></li>
                  </ul>
                </p>
              </div>
            </div>
          </div>
        </div>

        <!-- footer -->
        <footer id="footer" class="footer navbar-fixed-bottom" style="background-color:#f8f8f8; padding:20px 0; ">
          <div class="container">
              <p>This website is created by <a href="/index.html">TwoFlyLiu</a></p>
              <p>Code License is <a target="_blank" href="https://github.com/TwoFlyLiu/ecanspy3/blob/master/LICENSE">Apache License 2.0</a></p>
          </div>
        </footer>

        <script src="/assets/OwlCarousel/owl.carousel.min.js"></script>
        <script src="./assets/js/doc.js"></script>
    </body>
</html>